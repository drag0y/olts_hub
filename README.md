## OLTs HUB v2.1
WEB приложение для просмотра состояния абонентских оптических терминалов, фирмы Huawei и BDCOM\
Приложение работает с ОЛТами:\
Huawei MA5600, MA5800 (EPON, GPON).\
BDCOM 33xx, 36xx только EPON.\
Абонентские терминалы поддерживаются только однопортовые, для Huawei поддерживается CATV порт.\
Если портов больше 1, то приложение работать будет, но статус LAN порта будет выводиться некоректно.\
Весь остальной функционал будет работать как надо.

<p align="center">
<img src="https://github.com/drag0y/olts_hub/raw/main/static/images/onu-info.png" width="400">
</p>
<p align="center">
<img src="https://github.com/drag0y/olts_hub/raw/main/static/images/tree.png" width="400">
</p>

## Установка
Клонировать репозиторий в любую удобную директорию.
Установить необходимые модули из файла requirements.txt.
```
pip install -r requirements.txt
```
Далее переименовать файл-шаблон конфигурации __env_template.py__ в __.env__.
```commandline
mv env_template.py .env
```

В файле __.env__ заполнить данные для работы Flask. 
Если у вас была установлена предыдущая версия (v1.13.1 и старше), то в файле __.env__ остались настройки, связанные с Flask. Все остальные настройки переехали в БД, и нужно будет добавить их через WEB интерфейс.

При работе, программа использует snmpwalk. Поэтому, он дожен быть установлен в системе.\
У Ubuntu подобных системах это можно сделать так.
```commandline
sudo apt install snmp
```
## Добавление ОЛТов
В верхнем меню нажмите кнопку __Добавить OLT__ и заполните форму добавления ОЛТа. После чего нажмите __Добавить__.

## Настройка с NetBox
В NetBox необходимо создать теги для Epon и Gpon и привязать их к нужным ОЛТам, которые необходимо "опрашивать".\
Так же в NetBox необходимо создать платформу и привзать к ОЛТам.\
По умолчанию в конфигурации, платформы для НетБокса прописаны так:
```commandline
PF_HUAWEI = "Huawei_OLT"
PF_BDCOM = "BDCOM"
```
Это означает, что платформа должна содержать такие слова в названии.\
Например платформа, названная в НетБоксе как "BDCOM(tm) P3310B Software, Version 10.1.0B Build 63244", 
программой определится без проблем, т.к. содержит слово BDCOM.

## Первый запуск, создание новой базы
Перед первым запуском необходимо создать базу данных.\
В корневой директории приложения, необходимо запустить файл __create_db.py__
Данный скрипт создаст новую БД, если у вас уже была БД, то она удалится.
```commandline
python3 create_db.py
```
В случае успешного выполнения, на консоль будет выведено сообщение "Создана новая база данных:".\
Приложение работает с базой sqlite, для её работы, дополнительно устанавливать ничего не требуется. 
База данных представляет из себя файл с базой, в папке instance.\
## Если была установлена предыдущая версия
Если у Вас была установлена предыдущая версия (v1.13.1 и старше), и вы хотите сохранить БД с ОЛТами и ОНУ, то необходимо запустить файл __migratev1-v2.py__, который создаст новые таблицы, не удаляя таблиц с полезными данными.
```commandline
python3 migratev1-v2.py
```
После выполнения скрипта, будет сообщение об успешном завершении.

После чего можно запускать приложение.
```commandline
python3 app.py
```
После запуска приложения, откройте в браузере адрес хоста на котором установлено приложение, 
через двоеточие укажите порт, который прописали в __config.py__ (по умолчанию 5000).\
Например:
```commandline
http://192.168.1.20:5000
```
## Вход в приложение
В версии v2, появилась возможность создавать пользователей.\
Дефолтный логин/пароль - __root/admin__.

После входа в приложение, перейдите в меню настройки. Там необходимо заполнить все данные для работы.\
Если у вас уже была база, и Вы перешли со старой версии не удаляя её. То в меню 'Настройка NetBox' необходимо прописать платформы Ваших ОЛТов. Даже если вы не используете NetBox. Платформы нужны для определения производителя, т.к. у разных производителей разные SNMP OIDы.\

<p align="center">
<img src="https://github.com/drag0y/olts_hub/raw/main/static/images/doc_platforms.jpg" width="400">
</p>

Если платформа в настройках и платформа у добавленого ОЛТа не будут совпадать, то данные с этого ОЛТа собираться не будут.

В меню "Настройки" нажмите "Добавить OLT", и нажмите кнопку "Получить список ОЛТов из NetBox".
Если настройки NetBox корректные, то через пару секунд приложение поддянет список ОЛТов из НетБокса. 
И на экран будет выведено сообщение об успешном выполнении.\
Если вы настроили работу без НетБокса, то появится форма для добавления ОЛТа вручную.\
Затем нажать кнопку "Опросить ОЛТы".\
Это запустит процесс опроса __ВСЕХ__ ОЛТов в списке.\
В зависимости от количества ОЛТов и зарегистрированных ОНУ, 
этот процесс может занять от нескольких секунд до нескольких минут.\
Здесь нужно дождаться сообщения об успешном опросе.\
Как дальше работать с программой можно почитать в разделе "справка".
