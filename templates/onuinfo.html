{% extends 'base.html' %}

{% block title %}
Информация об ОНУ
{% endblock %}

{% block body %}


{% for item in onu_info %}

<div class="container col-md-5 col-lg-5 order-md-last" style="background-color: #FFFFFF; border-radius: 21px 21px 21px 21px;">
    
        <h4 class="text-center fw-bold">Информация об ОНУ</h4>
            
                <ul class="list-group mb-3">
        {% for msg in get_flashed_messages() %}

	    {% if "Ошибка" in msg or "ERROR" in msg or "отключена" in msg %}
                <h3 class="text-center"><span class="flash badge text-bg-danger">{{msg}}</span></h3>
            {% else %}
		<h3 class="text-center"><span class="flash badge text-bg-success">{{msg}}</span></h3>
	    {% endif %}

	{% endfor %}

                    
                    <table class="table">
                        <div class="text-center">
                    	{% if 'UP' in item.lanstate %}
                    		<img src="{{ url_for('static', filename='images/onu_on.png') }}" width="250">

                        	{% elif 'DOWN' in item.lanstate %}
                    		<img src="{{ url_for('static', filename='images/onu_lan_off.png') }}" width="250">
                    	    {% elif 'Не удалось определить' in item.lanstate %}
                            <img src="{{ url_for('static', filename='images/onu_lan_unknown.png') }}" width="250">
                            {% elif 'Power-Off' in item.reason_offline %}
                            <img src="{{ url_for('static', filename='images/onu_power_off.png') }}" width="250">
                            {% elif 'LOS' in item.reason_offline %}
                            <img src="{{ url_for('static', filename='images/onu_los.png') }}" width="250">
                    	{% endif %}
                    	</div>

                    <tbody class="table-group-divider">

                    <tr>
                       	<td class="fw-bold" width="400">Состояние ONU {{ item['mac/sn'] }}:</td>
                        {% if 'В сети' in item.iface_state %}
                    	<td><span class="badge text-bg-success rounded-pill fw-bold">{{ item.iface_state }}</span></td>
                        {% else %}
                    	<td><span class="badge text-bg-danger rounded-pill fw-bold">{{ item.iface_state }}</span></td>
                        {% endif %}

                    </tr>
                    <tbody class="table-group-divider">
                    <td>ONU найдена на OLTе:</td><td>{{ item.oltname }}<br>{{ item.oltip }}
                    <a 
              href="/oltshowlogs/{{ item.olt_id }}" 
              class="btn btn-info text-warning btn-sm" 
              type="submit"
              
              >
            <img 
                src="{{ url_for('static', filename='images/show_log.png') }}"
                title="Посмотреть логи ОЛТа" 
                width="20"
                >
            </a>
                    
                    </td>
                    </tbody>
                    <tr><td>Порт: {{ item.iface_name }}</td><td>id: {{ item.onuid }}
                        
                        <a 
              href="/onuconfinfo/{{ item.olt_id }}/{{ item['mac/sn'] }}" 
              class="btn btn-info text-warning btn-sm me-1" 
              type="submit"
              
              >
              <img 
                src="{{ url_for('static', filename='images/settings_ico.png') }}"
                title="Посмотреть конфигурацию ОНУ" 
                width="20"
                >
                                                    
                    </td></tr>
                    <tr><td>Статус LAN порта:</td><td>{{ item.lanstate }} {{ item.lanspeed }}</td></tr>
                    <tr><td>Мак адреса с LAN порта:</td>
                        <td>{% for i in item.lan_mac %}{{ i }}<br>{% endfor %}</td></tr>

                    <tr><td>Статус CATV порта:</td>
                        {% if 'OFF' in item.catvstate %}
                            <td>
                                <span class="badge text-bg-danger rounded-pill fw-bold">
                                {{ item.catvstate }}
                                </span>
                                <a href="/onuinfo/{{ item.olt_id }}/{{ item['mac/sn'] }}/catvon" class="btn btn-outline-dark">Включить</a>
                            </td>

                        {% elif 'ON' in item.catvstate %}
                            <td>
                                <span class="badge text-bg-success rounded-pill fw-bold">
                                {{ item.catvstate }}
                                </span>
                                <a href="/onuinfo/{{ item.olt_id }}/{{ item['mac/sn'] }}/catvoff" class="btn btn-outline-dark">Выключить</a>
                            </td>
                        {% else %}
                            <td>{{ item.catvstate }}</td>
                        {% endif %}
                    </tr>
                    <tr><td>Уровень сигнала CATV:</td><td>{{ item.catvlevel }}</td></tr>
                    <tr><td>Uptime / Время включения:</td><td>{{ item.timeup }}</td></tr>
                    <tr><td>Время последнего отключения:</td><td>{{ item.timedown }}</td></tr>
                    <tr><td>Причина последнего отключения:</td><td>{{ item.reason_offline }}</td></tr>
                    <tr><td>Сигнал в сторону ОНУ:</td><td>{{ item.level_onu_rx }}</td></tr>
                    <tr><td>Сигнал в сторону ОЛТа:</td><td>{{ item.level_olt_rx }}</td></tr>
                    </tbody>
                </ul>
            </table>



            
    <div class="row">
        <div class="col-md-4" style="text-align: center;">
        	<a href="/oltinfo/{{ item.olt_id }}/{{ item.iface_name|replace("/", ".") }}" class="btn btn-success ml-auto">Уровень дерева</a>
        </div>
        <div class="col-md-4" style="text-align: center;">
            <a href="/onuinfo/{{ item.olt_id }}/{{ item['mac/sn'] }}/reboot" class="btn btn-warning ml-auto">Перезагрузить ОНУ</a>
        </div>
        <div class="col-md-4" style="text-align: center;">
         <a href="/onuinfo/{{ item.olt_id }}/{{ item['mac/sn'] }}/deleteonu" class="btn btn-danger text-right">Удалить ОНУ</a>
         
        </div>
       <p></p>
    </div>
</div>
<br>
{% endfor %}

<br>
{% endblock %}
                    
